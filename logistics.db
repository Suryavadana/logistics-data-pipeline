-- Here are the 10 example SQL queries and home work problems. This is a blank file. Use it to practice and improve your SQL skills.

#10 Sample queries for SAKILA Database
select * from film; 
# 1) All films with PG-13 films with rental rate of 2.99 or lower
SELECT f.title
FROM film f 
WHERE rating = 'PG-13'
AND rental_rate <= 2.99;

# 2) All films that have deleted scenes
SELECT f. title , f.special_features
FROM film f
WHERE f.special_features like '%DELETED SCENES%';

# 3) All active customers
select * from customer;
SELECT first_name , active 
FROM CUSTOMER 
WHERE active =1 ;

SELECT COUNT(Active)
FROM customer
WHERE active=1;


# 4) Names of customers who rented a movie on 26th July 2005
SELECT CONCAT(c.first_name, c.last_name) AS full_name  , date(r.rental_date) FROM customer c
JOIN rental r ON c.customer_id=r.customer_id
WHERE r.rental_date LIKE '2005-07-26%';

# 5) Distinct names of customers who rented a movie on 26th July 2005
SELECT DISTINCT CONCAT(c.first_name, c.last_name) AS full_name  , date(r.rental_date) FROM customer c
JOIN rental r ON c.customer_id=r.customer_id
WHERE r.rental_date LIKE '2005-07-26%';

# H1) How many distinct last names we have in the data?
SELECT COUNT(DISTINCT last_name)
FROM customer;

# 6) How many rentals we do on each day?
SELECT date(rental_date) , COUNT(*) 
FROM rental
GROUP BY date(rental_date);

# 7) All Sci-fi films in our catalogue
select f.title from film f
JOIN film_Category fc ON fc.film_id = f.film_id
JOIN category c ON c.category_id= fc.category_id
WHERE c.category_id = 14
ORDER BY f.title;


# 8) Customers and how many movies they rented from us so far?
SELECT c.customer_id , CONCAT(c.first_name, ' ',c.last_name) AS full_name, COUNT(r.rental_id) AS total_rentals
FROM customer c
JOIN rental r ON r.customer_id = c.customer_id
GROUP BY c.customer_id, full_name
ORDER BY total_rentals DESC;

# 9) Which movies should we discontinue from our catalogue (less than 1 lifetime rentals)
WITH low_rentals AS
	(select i.film_id , count(*)
		from rental r
        join inventory i On i.inventory_id= r.inventory_id
        group by i.film_id
        having count(*) <=5)
	select low_rentals.film_id, f.title
from low_rentals
join film f on f.film_id = low_rentals.film_id;

# 10) Which movies are not returned yet?

# H2) How much money and rentals we make for Store 1 by day?
# What are the three top earning days so far?